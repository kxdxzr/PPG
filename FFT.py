import pandas as pd
import matplotlib.pyplot as plt
import numpy as np
from numpy.fft import fft, ifft

def FFT(pulse_rate, sample_rate):

    # remove DC offset from PPG data
    pulse_rate_array = np.array(pulse_rate)
    pulse_rate_array = pulse_rate_array - pulse_rate_array.mean()

    # calculate FFT
    fft_PPG = fft(pulse_rate_array)
    fft_y = np.abs(fft_PPG)
    N = len(fft_PPG)
    n = np.arange(N)
    T = N/sample_rate
    freq = n/T 
    # clunky bandpass filter using FFT data
    min_freq = 0.5
    max_freq = 10
    x_data, y_data = np.array([]), np.array([])
    for i in range(len(freq)):
        if min_freq <= freq[i] <= max_freq:
            x_data = np.append(x_data, freq[i])
            y_data = np.append(y_data, fft_y[i])
    # Get BPM
    bpm_freq = x_data[y_data.argmax()] * 60 # beats/s bpm: beats/min 
    
    return bpm_freq


##Example
#example_pulse_rate = [1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.219512195, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.19047619, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698, 1.162790698]
#bpm_point = FFT(example_pulse_rate, 50)
#print(bpm_point)



